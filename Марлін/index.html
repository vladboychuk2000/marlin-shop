<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Marlin Market - –ù–æ–≤–æ–º–∏—Ä–≥–æ—Ä–æ–¥</title>
    
    <meta property="og:title" content="üêü Marlin Market - –†–∏–±–Ω–∏–π –º–∞–≥–∞–∑–∏–Ω ‚Ññ1">
    <meta property="og:description" content="–ù–∞–π—Å–º–∞—á–Ω—ñ—à–∞ —Ä–∏–±–∞ —É –ù–æ–≤–æ–º–∏—Ä–≥–æ—Ä–æ–¥—ñ! –°–≤—ñ–∂–∞, –∫–æ–ø—á–µ–Ω–∞, –≤'—è–ª–µ–Ω–∞. –î–æ—Å—Ç–∞–≤–∫–∞ —Ç–∞ —Å–∞–º–æ–≤–∏–≤—ñ–∑.">
    <meta property="og:image" content="https://marlin-novomirgorod.netlify.app/poster.jpg">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üêü</text></svg>">
    
    <style>
        body { background-color: #f5f5f5; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; min-height: 100vh; }
        
        /* --- –ù–û–í–ï: –°–ü–Ü–ù–ï–† –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø --- */
        #loader { 
            position: fixed; top:0; left:0; width:100%; height:100%; 
            background: #fff; z-index: 9999; 
            display: flex; justify-content: center; align-items: center;
            transition: opacity 0.5s; /* –ü–ª–∞–≤–Ω–µ –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è */
        }
        .spinner { 
            width: 50px; height: 50px; 
            border: 5px solid #f3f3f3; border-top: 5px solid #00a046; 
            border-radius: 50%; animation: spin 1s linear infinite; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- –ù–û–í–ï: –ö–ù–û–ü–ö–ê –í–ì–û–†–£ --- */
        #scrollTopBtn { 
            display: none; /* –°–ø–æ—á–∞—Ç–∫—É —Å—Ö–æ–≤–∞–Ω–∞ */
            position: fixed; bottom: 25px; right: 25px; z-index: 99; 
            font-size: 20px; border: none; outline: none; 
            background-color: #00a046; color: white; cursor: pointer; 
            padding: 12px 18px; border-radius: 50%; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); 
            transition: 0.3s;
        }
        #scrollTopBtn:hover { background-color: #008037; transform: translateY(-3px); }

        /* HEADER */
        header { background-color: #00a046; padding: 15px 20px; display: flex; align-items: center; color: white; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.2); flex-wrap: wrap; gap: 10px; }
        .menu-btn { background: none; border: none; color: white; font-size: 28px; cursor: pointer; margin-right: 15px; }
        .logo { font-size: 26px; font-weight: bold; display: flex; align-items: center; gap: 10px; margin-right: auto; cursor: pointer; text-decoration: none; color: white; }
        .logo:hover { opacity: 0.8; }
        @media (max-width: 900px) { .logo { display: none; } }
        
        .store-status { font-size: 14px; font-weight: bold; padding: 5px 12px; border-radius: 20px; background-color: rgba(0,0,0,0.2); margin-right: 10px; display: flex; align-items: center; gap: 5px; white-space: nowrap; }
        @media (max-width: 600px) { .store-status { display: none; } }

        .search-bar { flex-grow: 1; max-width: 500px; display: flex; margin: 0 10px; }
        .search-bar input { width: 100%; padding: 12px; border: none; border-radius: 4px 0 0 4px; outline: none; font-size: 16px; }
        .search-btn { background-color: #3e3e3e; color: white; border: none; padding: 0 20px; border-radius: 0 4px 4px 0; cursor: pointer; font-size: 16px; }
        
        .header-icons { display: flex; align-items: center; gap: 15px; margin-left: auto; }
        .header-icon-btn { background: transparent; border: none; color: white; font-size: 26px; cursor: pointer; position: relative; }
        .cart-btn { background: transparent; border: none; color: white; font-size: 28px; cursor: pointer; position: relative; margin-left: 5px; line-height: 1; }
        
        .badge-count, .cart-count { position: absolute; top: -5px; right: -10px; background-color: #ff4444; color: white; font-size: 12px; font-weight: bold; min-width: 18px; height: 18px; line-height: 18px; text-align: center; border-radius: 50%; display: none; border: 2px solid #00a046; }

        /* SIDEBARS */
        .sidebar { height: 100%; width: 280px; position: fixed; top: 0; left: -280px; background-color: white; box-shadow: 2px 0 10px rgba(0,0,0,0.2); transition: 0.3s; z-index: 1000; overflow-y: auto; }
        .sidebar.active { left: 0; }
        .sidebar-header { background-color: #00a046; color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-size: 20px; }
        .close-btn { background: none; border: none; color: white; font-size: 28px; cursor: pointer; }
        .menu-item { padding: 15px 20px; font-size: 18px; color: #333; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #f0f0f0; transition: 0.2s; cursor: pointer; user-select: none; }
        .menu-item:hover { background-color: #e8f5e9; color: #00a046; padding-left: 25px; }

        .cart-sidebar { height: 100%; width: 350px; position: fixed; top: 0; right: -350px; background-color: white; box-shadow: -2px 0 10px rgba(0,0,0,0.2); transition: 0.3s; z-index: 1000; display: flex; flex-direction: column; }
        .cart-sidebar.active { right: 0; }
        .cart-items-container { flex-grow: 1; overflow-y: auto; padding: 15px; }
        .cart-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .cart-item img { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; margin-right: 10px; }
        .cart-item-info { flex-grow: 1; font-size: 16px; }
        .cart-item-title { font-weight: bold; margin-bottom: 5px; }
        .cart-item-price { font-size: 14px; color: #555; }
        .cart-item-remove { color: #ff4444; cursor: pointer; border: none; background: none; font-size: 22px; padding: 5px; transition: 0.3s; }
        .cart-item-remove:hover { color: #d32f2f; transform: scale(1.2); }
        .cart-footer { padding: 20px; border-top: 1px solid #eee; background-color: #f9f9f9; }
        .total-price { font-size: 24px; font-weight: bold; display: flex; justify-content: space-between; margin-bottom: 15px; }
        .checkout-btn { width: 100%; background-color: #00a046; color: white; border: none; padding: 15px; border-radius: 4px; font-size: 20px; cursor: pointer; transition: 0.3s; }
        .checkout-btn:hover { background-color: #008037; }
        .checkout-btn.disabled { background-color: #ccc; cursor: not-allowed; }
        #min-order-msg { color: #ff4444; font-size: 14px; margin-bottom: 10px; text-align: center; display: none; font-weight: bold; }
        
        /* MODALS */
        .product-modal { display: none; position: fixed; z-index: 3000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
        .product-modal.active { display: flex; animation: fadeIn 0.3s; }
        .product-modal-content { background-color: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 500px; text-align: left; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-height: 90vh; overflow-y: auto; }
        .checkout-modal-content { max-width: 600px; }
        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 30px; font-weight: bold; color: #aaa; cursor: pointer; }
        .modal-img { width: 100%; height: 250px; object-fit: cover; border-radius: 8px; margin-bottom: 20px; }
        .modal-title { font-size: 26px; color: #333; margin-bottom: 10px; }
        .modal-desc { font-size: 16px; color: #555; line-height: 1.6; margin-bottom: 20px; }
        .modal-price { font-size: 30px; color: #f84147; font-weight: bold; margin-bottom: 20px; }
        .modal-btn { width: 100%; background-color: #00a046; color: white; padding: 15px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; }
        .weight-input-container input { width: 140px; padding: 15px; font-size: 24px; font-weight: bold; text-align: center; border: 2px solid #00a046; border-radius: 8px; }
        
        .form-section { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .form-section h4 { margin-bottom: 10px; color: #00a046; font-size: 18px; border-left: 4px solid #00a046; padding-left: 10px; }
        .order-input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-size: 16px; }
        .delivery-options { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .delivery-option { display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 16px; background: #fff; padding: 10px; border: 1px solid #ddd; border-radius: 5px; flex: 1; justify-content: center; }
        .delivery-option:hover { background: #f0f0f0; border-color: #bbb; }

        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 900; display: none; }
        .overlay.active { display: block; }

        /* CARDS */
        .container { max-width: 1200px; margin: 20px auto; padding: 0 15px; flex: 1; }
        .products-grid { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
        .product-card { background: white; border: 1px solid #e9e9e9; border-radius: 8px; width: 250px; padding: 15px; transition: 0.3s; display: flex; flex-direction: column; justify-content: space-between; position: relative; }
        .product-card:hover { box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-color: #00a046; }
        .product-badge { position: absolute; top: 10px; left: 10px; padding: 4px 10px; border-radius: 4px; color: white; font-weight: bold; font-size: 12px; z-index: 10; }
        .badge-sale { background-color: #ff4444; } .badge-top { background-color: #ffab00; } .badge-new { background-color: #00c853; }
        .fav-btn { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.8); border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; font-size: 18px; color: #ccc; transition: 0.3s; z-index: 10; display: flex; align-items: center; justify-content: center; }
        .fav-btn.active { color: #ff4444; }
        .product-img { width: 100%; height: 180px; object-fit: cover; margin-bottom: 10px; border-radius: 4px; cursor: zoom-in; }
        .product-title { font-size: 18px; color: #333; margin-bottom: 5px; height: 44px; overflow: hidden; font-weight: 500; }
        .product-cat { font-size: 14px; color: #888; margin-bottom: 10px; }
        .price-row { display: flex; justify-content: space-between; align-items: center; margin-top: auto; }
        .price { font-size: 24px; color: #f84147; font-weight: bold; }
        .buy-btn { background-color: #00a046; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 20px; width: 40px; height: 40px; }

        /* SLIDER */
        .hero-slider { width: 100%; height: 200px; position: relative; overflow: hidden; color: white; text-align: center; display: flex; align-items: center; justify-content: center; flex-direction: column; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0; transition: opacity 1s ease-in-out; pointer-events: none; }
        .slide.active { opacity: 1; pointer-events: auto; }
        .slide-btn { background-color: white; color: #333; padding: 10px 25px; font-size: 18px; border: none; border-radius: 25px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .slide h2 { font-size: 36px; letter-spacing: 2px; text-shadow: 2px 2px 5px rgba(0,0,0,0.3); margin-bottom: 5px; }
        .slide p { font-size: 18px; letter-spacing: 1px; text-shadow: 1px 1px 3px rgba(0,0,0,0.3); }
        .gradient-1 { background: linear-gradient(45deg, #ff9a9e 0%, #fad0c4 99%); } 
        .gradient-2 { background: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%); } 
        .gradient-3 { background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%); } 

        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 5px; padding: 10px; position: fixed; z-index: 2000; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .history-list { max-height: 200px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 8px; margin-top: 15px; border: 1px solid #eee; }
        .history-item { border-bottom: 1px solid #ddd; padding: 10px 0; font-size: 14px; }
        .history-total { font-weight: bold; color: #00a046; }
        
        footer { background-color: #2c3e50; color: #ecf0f1; padding: 40px 20px 20px; margin-top: 50px; }
        .footer-content { max-width: 1200px; margin: 0 auto; display: flex; flex-wrap: wrap; justify-content: space-between; gap: 30px; }
        .footer-col { flex: 1; min-width: 250px; }
        .footer-col h3 { color: #00a046; margin-bottom: 20px; font-size: 18px; text-transform: uppercase; }
        .footer-col p, .footer-col a { color: #bdc3c7; text-decoration: none; line-height: 1.6; display: block; margin-bottom: 10px; }
        .social-icons a { display: inline-block; font-size: 24px; margin-right: 15px; color: white; }
        .copyright { text-align: center; border-top: 1px solid #34495e; padding-top: 20px; margin-top: 30px; color: #7f8c8d; font-size: 14px; }
    </style>
</head>
<body>

    <div id="loader"><div class="spinner"></div></div>

    <button onclick="topFunction()" id="scrollTopBtn" title="–í–≥–æ—Ä—É"><i class="fas fa-arrow-up"></i></button>

    <div id="toast"></div>
    <div class="overlay" id="overlay" onclick="closeAllMenus()"></div>

    <div id="productModal" class="product-modal" onclick="if(event.target === this) closeProductModal()">
        <div class="product-modal-content">
            <span class="close-modal" onclick="closeProductModal()">&times;</span>
            <img id="modalImg" class="modal-img" src="">
            <h3 id="modalTitle"></h3>
            <p id="modalDesc" style="font-size:16px; color:#555; line-height:1.5;"></p>
            <div id="modalPrice"></div>
            <div class="weight-input-container">
                <label>–í–∞–≥–∞ (–∫–≥) –∞–±–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å:</label>
                <input type="number" id="modalWeight" value="1" min="0.1" step="0.1">
            </div>
            <button id="modalBtn" class="modal-btn">–î–æ–¥–∞—Ç–∏ –≤ –∫–æ—à–∏–∫</button>
        </div>
    </div>

    <div id="profileModal" class="product-modal" onclick="if(event.target === this) closeProfileModal()">
        <div class="product-modal-content">
            <span class="close-modal" onclick="closeProfileModal()">&times;</span>
            <h2 style="margin-bottom:20px;">üë§ –ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å</h2>
            <input type="text" id="profileName" class="order-input" placeholder="–Ü–º'—è">
            <input type="text" id="profilePhone" class="order-input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
            <button class="modal-btn" onclick="saveProfile()">–ó–±–µ—Ä–µ–≥—Ç–∏ –¥–∞–Ω—ñ</button>
            <hr style="margin: 20px 0; border: none; border-top: 1px solid #eee;">
            <h3>üìú –Ü—Å—Ç–æ—Ä—ñ—è</h3>
            <div id="orderHistory" style="max-height:150px; overflow-y:auto; font-size:12px; background:#f9f9f9; padding:10px;"></div>
        </div>
    </div>

    <div id="checkoutModal" class="product-modal" onclick="if(event.target === this) closeCheckoutModal()">
        <div class="product-modal-content checkout-modal-content">
            <span class="close-modal" onclick="closeCheckoutModal()">&times;</span>
            <h2 style="margin-bottom:20px;">üì¶ –û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è</h2>
            <div class="form-section">
                <h4>1. –ö–æ–Ω—Ç–∞–∫—Ç–∏</h4>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="coName" class="order-input" placeholder="–Ü–º'—è">
                    <input type="text" id="coSurname" class="order-input" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ">
                </div>
                <input type="text" id="coPhone" class="order-input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
            </div>
            <div class="form-section">
                <h4>2. –î–æ—Å—Ç–∞–≤–∫–∞</h4>
                <div class="delivery-options">
                    <label class="delivery-option"><input type="radio" name="coDelivery" value="pickup" checked onchange="toggleCoDelivery()"> üèÉ –°–∞–º–æ–≤–∏–≤—ñ–∑</label>
                    <label class="delivery-option"><input type="radio" name="coDelivery" value="delivery" onchange="toggleCoDelivery()"> üöö –ö—É—Ä'—î—Ä</label>
                    <label class="delivery-option"><input type="radio" name="coDelivery" value="novaposhta" onchange="toggleCoDelivery()"> üì¶ –ù–æ–≤–∞ –ü–æ—à—Ç–∞</label>
                </div>
                <div id="coAddressBlock" style="display:none;">
                    <input type="text" id="coCity" class="order-input" value="–ù–æ–≤–æ–º–∏—Ä–≥–æ—Ä–æ–¥" placeholder="–ú—ñ—Å—Ç–æ">
                    <input type="text" id="coStreet" class="order-input" placeholder="–í—É–ª–∏—Ü—è —ñ –±—É–¥–∏–Ω–æ–∫">
                </div>
                <div id="npAddressBlock" style="display:none;">
                    <input type="text" id="npCity" class="order-input" placeholder="–ú—ñ—Å—Ç–æ" list="cityList">
                    <input type="text" id="npBranch" class="order-input" placeholder="‚Ññ –í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è">
                    <datalist id="cityList"><option value="–ù–æ–≤–æ–º–∏—Ä–≥–æ—Ä–æ–¥"><option value="–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π"><option value="–ö–∏—ó–≤"><option value="–õ—å–≤—ñ–≤"><option value="–û–¥–µ—Å–∞"><option value="–î–Ω—ñ–ø—Ä–æ"></datalist>
                </div>
            </div>
            <div class="form-section">
                <h4>3. –û–ø–ª–∞—Ç–∞</h4>
                <div class="delivery-options">
                    <label class="delivery-option"><input type="radio" name="coPayment" value="cash" checked> –ì–æ—Ç—ñ–≤–∫–∞</label>
                    <label class="delivery-option"><input type="radio" name="coPayment" value="card"> –ö–∞—Ä—Ç–∫–∞</label>
                </div>
                <input type="text" id="coComment" class="order-input" placeholder="–ö–æ–º–µ–Ω—Ç–∞—Ä...">
            </div>
            <div style="background:#eee; padding:10px; border-radius:5px; margin-bottom:15px; font-weight:bold; display:flex; justify-content:space-between; font-size:18px;">
                <span>–î–æ —Å–ø–ª–∞—Ç–∏:</span><span id="coTotalSum">0 –≥—Ä–Ω</span>
            </div>
            <button class="modal-btn" onclick="submitOrder()">–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò</button>
        </div>
    </div>

    <div class="sidebar" id="categorySidebar">
        <div class="sidebar-header"><span>–ö–∞—Ç–∞–ª–æ–≥</span><button class="close-btn" onclick="closeAllMenus()">&times;</button></div>
        <div class="menu-item" onclick="filterProducts('all')"><i class="fas fa-th-large"></i> –í—Å—ñ —Ç–æ–≤–∞—Ä–∏</div>
        <div class="menu-item" onclick="filterProducts('fresh')"><i class="fas fa-fish"></i> –°–≤—ñ–∂–∞ —Ä–∏–±–∞</div>
        <div class="menu-item" onclick="filterProducts('smoked')"><i class="fas fa-fire"></i> –ö–æ–ø—á–µ–Ω–∞</div>
        <div class="menu-item" onclick="filterProducts('salted')"><i class="fas fa-utensils"></i> –°–ª–∞–±–æ—Å–æ–ª–µ–Ω–∞</div>
        <div class="menu-item" onclick="filterProducts('dried')"><i class="fas fa-sun"></i> –í'—è–ª–µ–Ω–∞</div>
        <div class="menu-item" onclick="filterProducts('snacks')"><i class="fas fa-beer"></i> –°–Ω–µ–∫–∏</div>
        <div class="menu-item" onclick="filterProducts('salads')"><i class="fas fa-leaf"></i> –°–∞–ª–∞—Ç–∏</div>
    </div>

    <div class="cart-sidebar" id="cartSidebar">
        <div class="sidebar-header"><span>–ö–æ—à–∏–∫</span><button class="close-btn" onclick="closeAllMenus()">&times;</button></div>
        <div class="cart-items-container" id="cartItems"><p style="text-align:center; padding:20px; color:#888;">–ü—É—Å—Ç–æ</p></div>
        <div class="cart-footer">
            <div class="total-price"><span>–†–∞–∑–æ–º:</span><span id="cartTotal">0 –≥—Ä–Ω</span></div>
            <div id="min-order-msg">‚ö†Ô∏è –ú—ñ–Ω. –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è 500 –≥—Ä–Ω</div>
            <button id="checkoutBtn" class="checkout-btn" onclick="openCheckoutModal()">–û—Ñ–æ—Ä–º–∏—Ç–∏</button>
        </div>
    </div>

    <header>
        <button class="menu-btn" onclick="toggleCategoryMenu()"><i class="fas fa-bars"></i></button>
        <a href="index.html" class="logo"><i class="fas fa-fish"></i> MARLIN</a>
        <div id="storeStatus" class="store-status"></div>
        <div class="search-bar"><input type="text" placeholder="–ü–æ—à—É–∫..." oninput="searchProducts(this.value)"><button class="search-btn"><i class="fas fa-search"></i></button></div>
        <div class="header-icons">
            <button class="header-icon-btn" onclick="filterFavorites()"><i class="fas fa-heart"></i><span class="badge-count" id="favBadge">0</span></button>
            <button class="header-icon-btn" onclick="openProfileModal()"><i class="fas fa-user"></i></button>
            <button class="cart-btn" onclick="toggleCartMenu()"><i class="fas fa-shopping-cart"></i><span class="cart-count" id="cartBadge">0</span></button>
        </div>
    </header>

    <div class="hero-slider">
        <div class="slide gradient-1 active"><h2>üéâ –ó–Ω–∏–∂–∫–∏!</h2><p>-10% –Ω–∞ –≤–µ—Å—å –∞—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç</p><button class="slide-btn" onclick="filterProducts('smoked')">–î–∏–≤–∏—Ç–∏—Å—å</button></div>
        <div class="slide gradient-2"><h2>üöö –î–æ—Å—Ç–∞–≤–∫–∞</h2><p>–®–≤–∏–¥–∫–æ –ø–æ –º—ñ—Å—Ç—É</p><button class="slide-btn" onclick="toggleCartMenu()">–î–µ—Ç–∞–ª—ñ</button></div>
        <div class="slide gradient-3"><h2>üç∫ –°–Ω–µ–∫–∏</h2><p>–ö—Ä–∞—â–∏–π –≤–∏–±—ñ—Ä –¥–æ –ø–∏–≤–∞</p><button class="slide-btn" onclick="filterProducts('snacks')">–í–∏–±—Ä–∞—Ç–∏</button></div>
    </div>

    <div class="container">
        <h2 id="header-category" style="margin-bottom:20px; color:#333; border-bottom:2px solid #00a046; display:inline-block; padding-bottom:5px;">–í–µ—Å—å –∞—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç</h2>
        <div class="products-grid" id="catalog"></div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-col"><h3>üìû –ö–æ–Ω—Ç–∞–∫—Ç–∏</h3><p>+380 99 123 45 67</p><p>–º. –ù–æ–≤–æ–º–∏—Ä–≥–æ—Ä–æ–¥</p></div>
            <div class="footer-col"><h3>‚è∞ –ì—Ä–∞—Ñ—ñ–∫</h3><p>08:00 - 20:00</p></div>
            <div class="footer-col"><h3>–°–æ—Ü–º–µ—Ä–µ–∂—ñ</h3><div class="social-icons"><a href="#"><i class="fab fa-instagram"></i></a><a href="#"><i class="fab fa-facebook"></i></a></div></div>
        </div>
        <div class="copyright">¬© 2025 Marlin Market</div>
    </footer>

    <script>
        const TG_TOKEN = "8596921718:AAHPw88OLxV0nRyFP1rAz-jFnSISRR0ZoRk"; 
        const TG_CHAT_ID = "711546132";  
        const MIN_ORDER_SUM = 500; 
        
        // *** GOOGLE SHEET URL ***
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRI7MLivZNpcLEvDqN51JTbtac43sj7-BJRfFJdZpFhXogQL78reBMZNvxG7-ZBF7F63TS4LTMuRrfN/pub?output=csv';

        // *** FALLBACK PRODUCTS (–ó–ê–ü–ê–°–ù–Ü) ***
        const fallbackProducts = [
            { id: 1, name: "–ú–∞—Ä–ª—ñ–Ω –ê—Ç–ª–∞–Ω—Ç–∏—á–Ω–∏–π", price: 350, category: "fresh", img: "poster.jpg", badge: "top", desc: "–°–ø—Ä–∞–≤–∂–Ω—ñ–π –¥–µ–ª—ñ–∫–∞—Ç–µ—Å! –ú–∞—Ä–ª—ñ–Ω –º–∞—î —â—ñ–ª—å–Ω–µ –º'—è—Å–æ." },
            { id: 2, name: "–õ–æ—Å–æ—Å—å (–°—Ç–µ–π–∫)", price: 450, category: "fresh", img: "poster.jpg", badge: "new", desc: "–°–≤—ñ–∂—ñ —Å—Ç–µ–π–∫–∏ –ª–æ—Å–æ—Å—è –ø—Ä–µ–º—ñ—É–º —è–∫–æ—Å—Ç—ñ." },
            { id: 3, name: "–ö–æ—Ä–æ–ø –î–∑–µ—Ä–∫–∞–ª—å–Ω–∏–π", price: 120, category: "fresh", img: "poster.jpg", desc: "–ñ–∏–≤–∏–π –∫–æ—Ä–æ–ø –∑ –º—ñ—Å—Ü–µ–≤–∏—Ö —Å—Ç–∞–≤–∫—ñ–≤." },
            { id: 4, name: "–§–æ—Ä–µ–ª—å –†—ñ—á–∫–æ–≤–∞", price: 280, category: "fresh", img: "poster.jpg", desc: "–î—ñ—î—Ç–∏—á–Ω–∞ —Ä—ñ—á–∫–æ–≤–∞ —Ñ–æ—Ä–µ–ª—å." },
            { id: 5, name: "–°–∫—É–º–±—Ä—ñ—è –≥/–∫", price: 220, category: "smoked", img: "poster.jpg", badge: "sale", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 6, name: "–ü–∞–ª—Ç—É—Å –ö–æ–ø—á–µ–Ω–∏–π", price: 550, category: "smoked", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 7, name: "–í—É–≥–æ—Ä –ó–æ–ª–æ—Ç–∏—Å—Ç–∏–π", price: 800, category: "smoked", img: "poster.jpg", badge: "top", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 8, name: "–û–∫—É–Ω—å –ú–æ—Ä—Å—å–∫–∏–π", price: 190, category: "smoked", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 9, name: "–û—Å–µ–ª–µ–¥–µ—Ü—å –ú–∞—Ç—ñ–∞—Å", price: 180, category: "salted", img: "poster.jpg", badge: "sale", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 10, name: "–°—å–æ–º–≥–∞ —Ñ—ñ–ª–µ", price: 650, category: "salted", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 11, name: "–ö—ñ–ª—å–∫–∞ –ø—Ä—è–Ω–∞", price: 90, category: "salted", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 12, name: "–ê–Ω—á–æ—É—Å–∏ (–±–∞–Ω–∫–∞)", price: 150, category: "salted", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 13, name: "–¢–∞—Ä–∞–Ω—å –ê–∑–æ–≤—Å—å–∫–∞", price: 300, category: "dried", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 14, name: "–õ—è—â –≤'—è–ª–µ–Ω–∏–π", price: 250, category: "dried", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 15, name: "–ü–ª—ñ—Ç–∫–∞ (–Ü–∫—Ä—è–Ω–∞)", price: 320, category: "dried", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 16, name: "–©—É–∫–∞ –ø–∞–ª–æ—á–∫–∏", price: 400, category: "dried", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 17, name: "–ö–∞–ª—å–º–∞—Ä –∫—ñ–ª—å—Ü—è", price: 450, category: "snacks", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 18, name: "–¢—Ä—ñ—Å–∫–∞ —Å–º—É–∂–∫–∞–º–∏", price: 380, category: "snacks", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 19, name: "–Ø–Ω—Ç–∞—Ä–Ω–∞ –∑ –ø–µ—Ä—Ü–µ–º", price: 350, category: "snacks", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 20, name: "–ü–∞–≤—É—Ç–∏–Ω–∫–∞ —Ä–∏–±–Ω–∞", price: 360, category: "snacks", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 21, name: "–°–∞–ª–∞—Ç –ß—É–∫–∞", price: 150, category: "salads", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 22, name: "–ú–æ—Ä—Å—å–∫–∞ –∫–∞–ø—É—Å—Ç–∞", price: 90, category: "salads", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 23, name: "–ú—ñ–¥—ñ—ó –≤ –æ–ª—ñ—ó", price: 280, category: "salads", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." },
            { id: 24, name: "–ö–æ–∫—Ç–µ–π–ª—å –ú–æ—Ä—Å—å–∫–∏–π", price: 320, category: "salads", img: "poster.jpg", desc: "–°–º–∞—á–Ω–∞ —Ä–∏–±–∫–∞." }
        ];

        let products = [];
        let cart = [];
        let favorites = [];

        // --- MAIN INIT ---
        async function init() {
            loadStorage();
            // –°–ø—Ä–æ–±—É—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é. –Ø–∫—â–æ –Ω—ñ - –æ–¥—Ä–∞–∑—É –∑–∞–ø–∞—Å–Ω—ñ.
            // –í–ê–ñ–õ–ò–í–û: –ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ–Ω—É—î–º–æ finally
            try {
                await loadProducts();
            } catch(e) {
                console.log("Table Error - Using Fallback");
                products = fallbackProducts;
                filterProducts('all');
            } finally {
                // –í–ò–ú–ò–ö–ê–Ñ–ú–û –°–ü–Ü–ù–ï–† –£ –ë–£–î–¨-–Ø–ö–û–ú–£ –í–ò–ü–ê–î–ö–£
                document.getElementById("loader").style.display = "none";
            }

            checkStoreStatus();
            updateCartUI();
            updateFavCount();
            loadProfile();
        }

        async function loadProducts() {
            const res = await fetch(SHEET_URL);
            if(!res.ok) throw new Error("Net Error");
            const text = await res.text();
            const parsed = parseCSV(text);
            if(parsed.length > 0) { 
                products = parsed; 
                filterProducts('all'); 
            } else { 
                throw new Error("Empty"); 
            }
        }

        function parseCSV(text) {
            const rows = text.split(/\r?\n/);
            const data = [];
            for (let i = 1; i < rows.length; i++) {
                if (!rows[i].trim()) continue;
                const cols = [];
                let current = '';
                let inQuote = false;
                for (let j = 0; j < rows[i].length; j++) {
                    const char = rows[i][j];
                    if (char === '"') { inQuote = !inQuote; } 
                    else if (char === ',' && !inQuote) { cols.push(current); current = ''; } 
                    else { current += char; }
                }
                cols.push(current);
                const clean = cols.map(col => col.trim().replace(/^"|"$/g, '').replace(/""/g, '"'));
                
                if (clean.length >= 3) {
                    data.push({
                        id: Number(clean[0]),
                        name: clean[1],
                        price: Number(clean[2]),
                        category: clean[3] || 'fresh',
                        img: clean[4] || 'poster.jpg',
                        desc: clean[5] || '',
                        badge: clean[6] || ''
                    });
                }
            }
            return data;
        }

        // --- CORE ---
        function loadStorage() {
            try {
                if (localStorage.getItem("marlinCart")) cart = JSON.parse(localStorage.getItem("marlinCart"));
                if (localStorage.getItem("marlinFavorites")) favorites = JSON.parse(localStorage.getItem("marlinFavorites")).map(Number);
            } catch(e) {}
        }

        function saveCart() { localStorage.setItem("marlinCart", JSON.stringify(cart)); }
        function saveFavorites() { localStorage.setItem("marlinFavorites", JSON.stringify(favorites)); }
        function showNotification(message, color = "#333") { const toast = document.getElementById("toast"); toast.innerText = message; toast.style.backgroundColor = color; toast.className = "show"; setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000); }
        function updateFavCount() { const el = document.getElementById("favBadge"); el.innerText = favorites.length; el.style.display = favorites.length > 0 ? "block" : "none"; }
        function checkStoreStatus() { const now = new Date(); const hour = now.getHours(); const el = document.getElementById("storeStatus"); if(el) { if (hour >= 8 && hour < 20) { el.innerHTML = "üü¢ –í—ñ–¥–∫—Ä–∏—Ç–æ"; el.style.color = "#dcedc8"; } else { el.innerHTML = "üî¥ –ó–∞—á–∏–Ω–µ–Ω–æ"; el.style.color = "#ffcccc"; } } }
        function saveOrderToHistory(orderData) { let h = []; if (localStorage.getItem("marlinOrderHistory")) h = JSON.parse(localStorage.getItem("marlinOrderHistory")); h.unshift(orderData); localStorage.setItem("marlinOrderHistory", JSON.stringify(h)); }

        // --- RENDER ---
        function filterProducts(cat) {
            const catalog = document.getElementById("catalog"); 
            if(!catalog) return;
            catalog.innerHTML = "";
            products.forEach(p => {
                if (cat === 'all' || p.category === cat) renderCard(p, catalog);
            });
            const title = document.getElementById("header-category");
            if(title) { if (cat === 'all') title.innerText = "–í–µ—Å—å –∞—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç"; else title.innerText = getCategoryName(cat); }
            closeAllMenus();
        }

        function renderCard(p, container) {
            let badge = "";
            if(p.badge === 'top') badge = '<div class="product-badge badge-top">üî• –•–Ü–¢</div>';
            if(p.badge === 'sale') badge = '<div class="product-badge badge-sale">% –ê–ö–¶–Ü–Ø</div>';
            if(p.badge === 'new') badge = '<div class="product-badge badge-new">üÜï –ù–û–í–ò–ù–ö–ê</div>';
            const isFav = favorites.some(favId => Number(favId) === Number(p.id));
            const heartClass = isFav ? "active" : "";
            const heartIcon = isFav ? "fas fa-heart" : "far fa-heart";
            container.innerHTML += `
                <div class="product-card">
                    ${badge}
                    <button class="fav-btn ${heartClass}" onclick="toggleFavorite('${p.id}', this, event)"><i class="${heartIcon}"></i></button>
                    <img src="${p.img}" class="product-img" onclick="openProductModal('${p.id}')">
                    <div class="product-title">${p.name}</div>
                    <div class="product-cat">${getCategoryName(p.category)}</div>
                    <div class="price-row"><span class="price">${p.price} –≥—Ä–Ω</span><button class="buy-btn" onclick="openProductModal('${p.id}')"><i class="fas fa-shopping-cart"></i></button></div>
                </div>`;
        }

        function getCategoryName(cat) {
            if (cat === 'fresh') return "–°–≤—ñ–∂–∞ —Ä–∏–±–∞"; if (cat === 'smoked') return "–ö–æ–ø—á–µ–Ω–∞ —Ä–∏–±–∞"; if (cat === 'salted') return "–°–ª–∞–±–æ—Å–æ–ª–µ–Ω–∞ —Ä–∏–±–∞";
            if (cat === 'dried') return "–í'—è–ª–µ–Ω–∞ —Ä–∏–±–∞"; if (cat === 'snacks') return "–°–Ω–µ–∫–∏ –¥–æ –ø–∏–≤–∞"; if (cat === 'salads') return "–°–∞–ª–∞—Ç–∏ —Ç–∞ –ø—Ä–µ—Å–µ—Ä–≤–∏"; return "–í–µ—Å—å –∞—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç";
        }
        function getCategoryCode(name) {
             if(name === "–°–≤—ñ–∂–∞ —Ä–∏–±–∞") return "fresh"; if(name === "–ö–æ–ø—á–µ–Ω–∞ —Ä–∏–±–∞") return "smoked"; if(name === "–°–ª–∞–±–æ—Å–æ–ª–µ–Ω–∞ —Ä–∏–±–∞") return "salted";
             if(name === "–í'—è–ª–µ–Ω–∞ —Ä–∏–±–∞") return "dried"; if(name === "–°–Ω–µ–∫–∏ –¥–æ –ø–∏–≤–∞") return "snacks"; if(name === "–°–∞–ª–∞—Ç–∏ —Ç–∞ –ø—Ä–µ—Å–µ—Ä–≤–∏") return "salads";
             return 'all';
        }
        function searchProducts(val) { 
            const cat = document.getElementById("catalog"); cat.innerHTML = "";
            products.forEach(p => { if(p.name.toLowerCase().includes(val.toLowerCase())) renderCard(p, cat); });
            document.getElementById("header-category").innerText = "–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É";
        }

        // --- ACTIONS ---
        function toggleFavorite(id, btn, e) {
            e.stopPropagation();
            const numId = Number(id);
            const idx = favorites.indexOf(numId);
            if (idx === -1) { favorites.push(numId); showNotification("–î–æ–¥–∞–Ω–æ ‚ù§Ô∏è"); btn.classList.add("active"); btn.innerHTML = '<i class="fas fa-heart"></i>'; } 
            else { favorites.splice(idx, 1); showNotification("–í–∏–¥–∞–ª–µ–Ω–æ üíî"); btn.classList.remove("active"); btn.innerHTML = '<i class="far fa-heart"></i>'; }
            saveFavorites(); updateFavCount();
        }

        function filterFavorites() {
            const catalog = document.getElementById("catalog"); catalog.innerHTML = "";
            document.getElementById("header-category").innerText = "‚ù§Ô∏è –£–ª—é–±–ª–µ–Ω—ñ —Ç–æ–≤–∞—Ä–∏";
            const favs = products.filter(p => favorites.includes(Number(p.id)));
            if(favs.length === 0) { catalog.innerHTML = "<p style='width:100%;text-align:center'>–ü—É—Å—Ç–æ</p>"; return; }
            favs.forEach(p => renderCard(p, catalog));
            closeAllMenus();
        }

        function addToCart(id, weight) {
            const p = products.find(x => x.id == id);
            const item = cart.find(x => x.id == id);
            const w = parseFloat(weight);
            if(item) { item.weight += w; } else { cart.push({...p, weight: w}); }
            saveCart(); updateCartUI(); showNotification("–î–æ–¥–∞–Ω–æ!");
        }
        function removeFromCart(id) { cart = cart.filter(x => x.id != id); saveCart(); updateCartUI(); showNotification("üóëÔ∏è –í–∏–¥–∞–ª–µ–Ω–æ"); }
        function updateCartUI() {
            const el = document.getElementById("cartItems");
            const badge = document.getElementById("cartBadge");
            const totalEl = document.getElementById("cartTotal");
            const minMsg = document.getElementById("min-order-msg");
            const btn = document.getElementById("checkoutBtn");
            badge.innerText = cart.length; badge.style.display = cart.length ? "block" : "none";
            const total = cart.reduce((acc, x) => acc + (x.price * x.weight), 0);
            totalEl.innerText = total.toFixed(0) + " –≥—Ä–Ω";
            if(total < MIN_ORDER_SUM) { btn.classList.add("disabled"); btn.disabled = true; minMsg.style.display = "block"; } 
            else { btn.classList.remove("disabled"); btn.disabled = false; minMsg.style.display = "none"; }
            el.innerHTML = "";
            if(!cart.length) { el.innerHTML = "<p style='text-align:center;color:#888'>–ü—É—Å—Ç–æ</p>"; return; }
            cart.forEach(x => {
                el.innerHTML += `<div class="cart-item"><img src="${x.img}"><div class="cart-item-info"><div>${x.name}</div><div>${parseFloat(x.weight.toFixed(2))} –∫–≥ x ${x.price}</div></div><button class="cart-item-remove" onclick="removeFromCart('${x.id}')"><i class="fas fa-trash-alt"></i></button></div>`;
            });
        }

        // --- CHECKOUT ---
        function openCheckoutModal() {
            closeAllMenus();
            if(localStorage.getItem("marlinProfile")) {
                const data = JSON.parse(localStorage.getItem("marlinProfile"));
                document.getElementById("coName").value = data.name || "";
                document.getElementById("coSurname").value = data.surname || "";
                document.getElementById("coPhone").value = data.phone || "";
            }
            const total = cart.reduce((acc, x) => acc + (x.price * x.weight), 0);
            document.getElementById("coTotalSum").innerText = total.toFixed(0) + " –≥—Ä–Ω";
            document.getElementById("checkoutModal").classList.add("active");
        }
        function closeCheckoutModal() { document.getElementById("checkoutModal").classList.remove("active"); }
        function toggleCoDelivery() {
            const val = document.querySelector('input[name="coDelivery"]:checked').value;
            document.getElementById("coAddressBlock").style.display = (val === "delivery") ? "block" : "none";
            document.getElementById("npAddressBlock").style.display = (val === "novaposhta") ? "block" : "none";
        }
        function submitOrder() {
            const name = document.getElementById("coName").value;
            const surname = document.getElementById("coSurname").value;
            const phone = document.getElementById("coPhone").value;
            const delivery = document.querySelector('input[name="coDelivery"]:checked').value;
            const payment = document.querySelector('input[name="coPayment"]:checked').value;
            const comment = document.getElementById("coComment").value;
            if(!name || !phone) { showNotification("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç–∏!", "red"); return; }
            let addrText = "–°–∞–º–æ–≤–∏–≤—ñ–∑";
            if(delivery === "delivery") {
                const street = document.getElementById("coStreet").value;
                if(!street) { showNotification("–í–≤–µ–¥—ñ—Ç—å –∞–¥—Ä–µ—Å—É!", "red"); return; }
                addrText = "–ö—É—Ä'—î—Ä: " + document.getElementById("coCity").value + ", " + street;
            } else if (delivery === "novaposhta") {
                const city = document.getElementById("npCity").value;
                const branch = document.getElementById("npBranch").value;
                if(!city || !branch) { showNotification("–í–≤–µ–¥—ñ—Ç—å –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è!", "red"); return; }
                addrText = `–ù–ü: ${city}, ${branch}`;
            }
            let msg = `<b>–ó–ê–ú–û–í–õ–ï–ù–ù–Ø</b>\nüë§ ${name} ${surname}\nüìû ${phone}\nüì¶ ${addrText}\nüí∞ ${payment}\n`;
            if(comment) msg += `üí¨ ${comment}\n`;
            msg += `---\n`;
            let total = 0; let histItems = "";
            cart.forEach(x => {
                const sum = x.price * x.weight; total += sum;
                const line = `${x.name} (${parseFloat(x.weight.toFixed(2))} –∫–≥) - ${sum.toFixed(0)} –≥—Ä–Ω`;
                msg += line + "\n"; histItems += line + ", ";
            });
            msg += `---\n<b>–†–ê–ó–û–ú: ${total.toFixed(0)} –≥—Ä–Ω</b>`;
            fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ chat_id: TG_CHAT_ID, text: msg, parse_mode: 'HTML' })
            }).then(r => {
                if(r.ok) {
                    showNotification("–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ! ‚úÖ", "green");
                    let h = [];
                    try { if(localStorage.getItem("marlinOrderHistory")) h = JSON.parse(localStorage.getItem("marlinOrderHistory")); } catch(e){}
                    h.unshift({ date: new Date().toLocaleString(), items: histItems, total: total.toFixed(0) + " –≥—Ä–Ω" });
                    localStorage.setItem("marlinOrderHistory", JSON.stringify(h));
                    const profileData = { name: name, surname: surname, phone: phone };
                    localStorage.setItem("marlinProfile", JSON.stringify(profileData));
                    cart = []; saveCart(); updateCartUI(); closeCheckoutModal();
                } else { showNotification("–ü–æ–º–∏–ª–∫–∞", "red"); }
            });
        }

        function closeProductModal() { document.getElementById("productModal").classList.remove("active"); }
        function openProfileModal() { 
            const histDiv = document.getElementById("orderHistory");
            try {
                if(localStorage.getItem("marlinOrderHistory")) {
                    const h = JSON.parse(localStorage.getItem("marlinOrderHistory"));
                    histDiv.innerHTML = h.map(o => `<div style="border-bottom:1px solid #ddd; padding:5px; font-size:12px;"><b>${o.date}</b><br>${o.items}<br><b>${o.total}</b></div>`).join("");
                }
            } catch(e){}
            if(localStorage.getItem("marlinProfile")) {
                const data = JSON.parse(localStorage.getItem("marlinProfile"));
                document.getElementById("profileName").value = data.name || "";
                document.getElementById("profilePhone").value = data.phone || "";
            }
            document.getElementById("profileModal").classList.add("active"); 
        }
        function closeProfileModal() { document.getElementById("profileModal").classList.remove("active"); }
        function saveProfile() {
            localStorage.setItem("marlinProfile", JSON.stringify({ name: document.getElementById("profileName").value, phone: document.getElementById("profilePhone").value }));
            showNotification("–ó–±–µ—Ä–µ–∂–µ–Ω–æ!"); closeProfileModal();
        }
        function openProductModal(id) {
            const p = products.find(x => x.id == id);
            if(!p) return;
            document.getElementById("modalImg").src = p.img;
            document.getElementById("modalTitle").innerText = p.name;
            document.getElementById("modalDesc").innerText = p.desc;
            document.getElementById("modalPrice").innerText = p.price + " –≥—Ä–Ω/–∫–≥";
            document.getElementById("modalWeight").value = 1;
            document.getElementById("modalBtn").onclick = () => { addToCart(p.id, document.getElementById("modalWeight").value); closeProductModal(); };
            document.getElementById("productModal").classList.add("active");
        }
        function toggleCategoryMenu() { document.getElementById("categorySidebar").classList.add("active"); document.getElementById("overlay").classList.add("active"); }
        function toggleCartMenu() { document.getElementById("cartSidebar").classList.add("active"); document.getElementById("overlay").classList.add("active"); }
        function closeAllMenus() { document.getElementById("categorySidebar").classList.remove("active"); document.getElementById("cartSidebar").classList.remove("active"); document.getElementById("overlay").classList.remove("active"); closeProductModal(); closeCheckoutModal(); closeProfileModal(); }
        function searchProducts(val) { 
            const cat = document.getElementById("catalog"); cat.innerHTML = "";
            products.forEach(p => { if(p.name.toLowerCase().includes(val.toLowerCase())) renderCard(p, cat); });
            document.getElementById("header-category").innerText = "–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É";
        }
        function topFunction() { window.scrollTo({top: 0, behavior: 'smooth'}); }
        window.onscroll = function() {
            const btn = document.getElementById("scrollTopBtn");
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) { btn.style.display = "block"; } 
            else { btn.style.display = "none"; }
        };

        init();
        let slide = 0; const slides = document.querySelectorAll('.slide');
        setInterval(() => { if(slides.length){ slides[slide].classList.remove('active'); slide=(slide+1)%slides.length; slides[slide].classList.add('active'); } }, 4000);

    </script>
</body>
</html>